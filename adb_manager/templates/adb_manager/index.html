{% extends 'base.html' %}  <!-- æ ¸å¿ƒï¼šç»§æ‰¿baseæ¨¡æ¿ -->
{% load static %}

<!-- 1. é¡µé¢æ ‡é¢˜ -->
{% block title %}{{ page_title }}{% endblock %}

<!-- 2. ä»…ä¿ç•™baseæœªè¦†ç›–çš„ã€Œä¸šåŠ¡ç‰¹æœ‰æ ·å¼ã€ -->
{% block extra_css %}
<style>
    /* è®¾å¤‡çŠ¶æ€æ–‡å­—æ ·å¼ï¼ˆbaseæ— æ­¤æ ·å¼ï¼‰ */
    .status-online { color: #67c23a; font-weight: 500; }
    .status-offline { color: #f56c6c; }
    .status-error { color: #e6a23c; }

    /* æ“ä½œå°æŒ‰é’®æ ·å¼ï¼ˆç‰¹æœ‰ï¼‰ */
    .action-btn {
        padding: 4px 8px;
        font-size: 12px;
        margin-right: 5px;
    }

    /* åºåˆ—å·åˆ—æ¢è¡Œæ ·å¼ï¼ˆç‰¹æœ‰ï¼‰ */
    .serial-column {
        max-width: 200px;
        word-break: break-all;
    }

    /* è®¾å¤‡è¡¨æ ¼hoveræ•ˆæœï¼ˆbaseè¡¨æ ¼æ— hoverï¼Œè¡¥å……ï¼‰ */
    .device-table tr:hover {
        background-color: #f8f9fa;
    }

    /* ç©ºæ•°æ®å•å…ƒæ ¼æ ·å¼ */
    .empty-device-cell {
        text-align: center;
        padding: 30px !important;
    }
</style>
{% endblock %}

<!-- 3. é¡µé¢å¤´éƒ¨ï¼ˆæ ‡é¢˜+æ“ä½œæŒ‰é’®ï¼‰ï¼šå¤ç”¨baseçš„page-headerå¸ƒå±€ -->
{% block page_header %}
<div class="page-header">
    <h1>ğŸ“± {{ page_title }}</h1>
    <div class="btn-group">
        <a href="{% url 'adb_manager:add_device' %}" class="btn btn-primary">æ·»åŠ è®¾å¤‡</a>
        <form method="POST" action="{% url 'adb_manager:connect_all' %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-success">ä¸€é”®è¿æ¥æ‰€æœ‰</button>
        </form>
        <form method="POST" action="{% url 'adb_manager:disconnect_all' %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">ä¸€é”®æ–­å¼€æ‰€æœ‰</button>
        </form>
        <form method="POST" action="{% url 'adb_manager:refresh_all' %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-warning">åˆ·æ–°æ‰€æœ‰çŠ¶æ€</button>
        </form>
    </div>
</div>
{% endblock %}

<!-- 4. æ ¸å¿ƒå†…å®¹åŒºåŸŸï¼šæç¤ºä¿¡æ¯+è®¾å¤‡è¡¨æ ¼ -->
{% block content %}
    <!-- æç¤ºä¿¡æ¯ï¼ˆå¤ç”¨baseçš„msg-boxæ ·å¼ï¼‰ -->
    {% if request.GET.msg %}
        <div class="msg-box {% if 'æˆåŠŸ' in request.GET.msg %}msg-success{% else %}msg-error{% endif %}">
            {{ request.GET.msg }}
        </div>
    {% endif %}

    <!-- è®¾å¤‡åˆ—è¡¨ï¼šå¥—baseçš„cardæ ·å¼ï¼Œç²¾ç®€device-table -->
    <div class="card">
        <table class="device-table">
            <thead>
                <tr>
                    <th>è®¾å¤‡åç§°</th>
                    <th>åºåˆ—å·</th>
                    <th>IP:ç«¯å£</th>
                    <th>è¿æ¥æ ‡è¯†</th>
                    <th>çŠ¶æ€</th>
                    <th>æ˜¯å¦å¯ç”¨</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for device in devices %}
                    <tr>
                        <td>{{ device.name }}</td>
                        <td class="serial-column">{{ device.serial|default:"-" }}</td>
                        <td>{{ device.ip|default:"-" }}:{{ device.port|default:"-" }}</td>
                        <td>{{ device.connect_id }}</td>
                        <td>
                            {% if device.status == 'online' %}
                                <span class="status-online">âœ… åœ¨çº¿</span>
                            {% elif device.status == 'error' %}
                                <span class="status-error">âš ï¸ å¼‚å¸¸</span>
                            {% else %}
                                <span class="status-offline">âŒ ç¦»çº¿</span>
                            {% endif %}
                        </td>
                        <td>{% if device.is_active %}âœ… æ˜¯{% else %}âŒ å¦{% endif %}</td>
                        <td>
                            <!-- è¿æ¥ -->
                            <form method="POST" action="{% url 'adb_manager:connect' %}" style="display: inline;">
                                {% csrf_token %}
                                <input type="hidden" name="device_id" value="{{ device.id }}">
                                <button type="submit" class="btn btn-success action-btn">è¿æ¥</button>
                            </form>
                            <!-- æ–­å¼€ -->
                            <form method="POST" action="{% url 'adb_manager:disconnect' %}" style="display: inline;">
                                {% csrf_token %}
                                <input type="hidden" name="device_id" value="{{ device.id }}">
                                <button type="submit" class="btn btn-danger action-btn">æ–­å¼€</button>
                            </form>
                            <!-- ç¼–è¾‘ -->
                            <a href="{% url 'adb_manager:edit_device' device.id %}" class="btn btn-primary action-btn">ç¼–è¾‘</a>
                            <!-- åˆ é™¤ -->
                            <form method="POST" action="{% url 'adb_manager:delete_device' device.id %}" style="display: inline;" onsubmit="return confirm('ç¡®å®šåˆ é™¤è¯¥è®¾å¤‡å—ï¼Ÿ');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-warning action-btn">åˆ é™¤</button>
                            </form>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="7" class="empty-device-cell">
                            æš‚æ— è®¾å¤‡ï¼Œè¯·ç‚¹å‡»ã€Œæ·»åŠ è®¾å¤‡ã€æŒ‰é’®æ·»åŠ 
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

<!-- 5. é¡µé¢æ— é¢å¤–JSï¼Œçœç•¥æˆ–ç•™ç©ºå‡å¯ -->
{% block extra_js %}{% endblock %}